<div class="container mt-4">
  <h3>ðŸ›’ Carrito</h3>

  <div *ngIf="items.length === 0" class="alert alert-info">
    No hay productos en el carrito.
  </div>

  <ul class="list-group mb-3" *ngIf="items.length > 0">
    <li
      *ngFor="let item of items"
      class="list-group-item d-flex justify-content-between align-items-center"
    >
      <div class="me-3">
        <strong>{{ item.titulo }}</strong><br />
        <small>{{ item.autor || 'Autor no disponible' }}</small>
      </div>

      <div class="d-flex align-items-center gap-3">
        <div class="d-flex align-items-center gap-2">
          <label class="form-label m-0 small">Cantidad</label>
          <input
            type="number"
            class="form-control form-control-sm"
            min="1"
            [max]="item.stock"
            [value]="item.cantidad"
            (change)="onQtyChange(item.idLibro, $event)"
          />
          <small class="text-muted">Stock: {{ item.stock }}</small>
        </div>

        <span class="text-nowrap">
          {{ item.cantidad }} x ${{ item.precio }}
        </span>

        <button
          class="btn btn-sm btn-outline-danger"
          (click)="removerItem(item.idLibro)"
        >
          Eliminar
        </button>
      </div>
    </li>
  </ul>

  <div class="d-flex justify-content-between align-items-center" *ngIf="items.length > 0">
    <strong>Total:</strong>
    <strong>${{ total }}</strong>
  </div>

  <div class="mt-3" *ngIf="items.length > 0">
    <button class="btn btn-primary w-100" (click)="confirmarCompra()">
      Confirmar compra
    </button>
  </div>
</div>

<!-- Offcanvas detalle libro -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="bookDetailModal" aria-labelledby="bookDetailModalLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="bookDetailModalLabel">
      {{ selectedItem?.titulo || 'Detalle del libro' }}
    </h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>

  <div class="offcanvas-body" *ngIf="selectedItem as sel">
    <img
      *ngIf="sel.imagen"
      [src]="sel.imagen"
      class="img-fluid rounded mb-3"
      alt="imagen libro"
    />

    <p><strong>Autor:</strong> {{ sel.autor || 'Autor no disponible' }}</p>
    <p class="mb-2">{{ sel.descripcion }}</p>
    <p class="mb-3"><strong>Precio:</strong> ${{ sel.precio }}</p>

    <div class="mb-3">
      <label class="form-label">Cantidad</label>
      <input
        type="number"
        class="form-control"
        min="1"
        [max]="sel.stock"
        [value]="sel.cantidad"
        (change)="onQtyChange(sel.idLibro, $event)"
      />
      <small class="text-muted">Stock disponible: {{ sel.stock }}</small>
    </div>

    <button class="btn btn-success w-100" (click)="confirmarAgregar()">
      Confirmar agregar al carrito
    </button>
  </div>
</div>

