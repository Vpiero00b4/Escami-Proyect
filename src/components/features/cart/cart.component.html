<div *ngIf="mostrarCarro" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[1050] transition-all duration-300"
  (click)="cerrarCarro()">
</div>


<div *ngIf="mostrarCarro"
  class="fixed top-0 right-0 h-full w-96 bg-white shadow-2xl z-[1100] flex flex-col transition-all duration-300 transform translate-x-0 border-l border-gray-200"
  style="margin-top: 80px;">


  <div
    class="flex justify-between items-center p-6 border-b bg-gradient-to-r from-blue-50 to-indigo-50 border-gray-200">
    <h2 class="text-2xl font-bold flex items-center gap-3 text-gray-800">
      <span class="text-3xl">ğŸ›’</span>
      <span class="bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">Carrito</span>
    </h2>
    <button (click)="cerrarCarro()"
      class="text-gray-500 hover:text-red-500 text-3xl transition-all duration-300 hover:rotate-90 p-2 rounded-full hover:bg-red-50">
      &times;
    </button>
  </div>


  <div *ngIf="itemsCarrito.length > 0" class="px-6 py-2 bg-blue-50 border-b border-blue-100">
    <span class="text-sm font-medium text-blue-700">
      {{ itemsCarrito.length }} {{ itemsCarrito.length === 1 ? 'producto' : 'productos' }} en tu carrito
    </span>
  </div>


  <div class="flex-1 overflow-y-auto p-6 space-y-4 bg-gray-50/30">


    <div *ngIf="itemsCarrito.length === 0" class="text-center py-16">
      <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
        <span class="text-4xl text-gray-400">ğŸ›’</span>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-2">Tu carrito estÃ¡ vacÃ­o</h3>
      <p class="text-gray-500 text-sm">Agrega algunos productos para comenzar</p>
    </div>


    <div *ngFor="let item of itemsCarrito; let i = index"
      class="bg-white border border-gray-200 rounded-2xl p-4 shadow-sm hover:shadow-md transition-all duration-300 hover:-translate-y-1">

      <div class="flex gap-4 items-start">

        <div class="relative">
          <img [src]="getImagen(item)" class="w-20 h-24 object-cover rounded-xl shadow-sm border border-gray-100"
            alt="Imagen del producto" />
          <div
            class="absolute -top-2 -right-2 bg-blue-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center">
            {{ item.cantidad }}
          </div>
        </div>


        <div class="flex-1 min-w-0">
          <h3 class="font-bold text-gray-900 text-base mb-1 line-clamp-2 leading-tight">
            {{ getTitulo(item) }}
          </h3>
          <p class="text-gray-600 text-sm mb-3 line-clamp-2">
            {{ getDescripcion(item) }}
          </p>


          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <label class="text-xs font-medium text-gray-500">Cantidad:</label>
              <select [(ngModel)]="item.cantidad" (change)="onQtyChange(item, item.cantidad)"
                class="border border-gray-300 rounded-lg px-3 py-1 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200">
                <option *ngFor="let n of [1,2,3,4,5,6,7,8,9,10]" [value]="n">{{ n }}</option>
              </select>
            </div>

            <button (click)="delete(i)"
              class="text-red-400 hover:text-red-600 transition-colors duration-200 p-2 rounded-lg hover:bg-red-50">
              <span class="text-lg">ğŸ—‘ï¸</span>
            </button>
          </div>

          Precio
          <div class="mt-3 flex justify-between items-center">
            <span class="text-sm text-gray-500">Precio unitario: S/ {{ item.precioVenta }}</span>
            <span class="font-bold text-lg text-blue-600">
              S/ {{ (item.precioVenta * item.cantidad).toFixed(2) }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>


  <div class="p-6 border-t bg-white shadow-lg">
    Resumen de totales
    <div class="space-y-2 mb-4">
      <div class="flex justify-between text-sm text-gray-600">
        <span>Subtotal:</span>
        <span>S/ {{ total }}</span>
      </div>
      <div class="flex justify-between text-sm text-gray-600">
        <span>EnvÃ­o:</span>
        <span class="text-green-600 font-medium">Gratis</span>
      </div>
      <div class="border-t pt-2">
        <div class="flex justify-between font-bold text-lg text-gray-900">
          <span>Total:</span>
          <span class="text-blue-600">S/ {{ total }}</span>
        </div>
      </div>
    </div>


    <button
      class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 px-4 rounded-xl font-semibold text-base hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 transform hover:-translate-y-0.5 hover:shadow-lg disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none"
      [disabled]="itemsCarrito.length === 0" (click)="finalizarCompra()">

      <span *ngIf="itemsCarrito.length > 0" class="flex items-center justify-center gap-2">
        <span>ğŸ’³</span>
        Finalizar Compra
      </span>
      <span *ngIf="itemsCarrito.length === 0">
        Carrito VacÃ­o
      </span>
    </button>



    <p class="text-center text-xs text-gray-500 mt-3">
      ğŸšš EnvÃ­o gratis en compras mayores a S/ 100
    </p>
  </div>
</div>